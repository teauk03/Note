# 1. 프로세스 동기화 (Process Synchronization)
* 여러 프로세스가 **공유하는 자원의 일관성을 유지하기 위한 방법**
* 공동의 목적을 위해 **동시에 수행되는 프로세스들이 충돌 없이 올바르게 동작하도록 관리**하는 개념
* 주로 `공유 자원(Shared Resource)` 과 `임계 구역(Critical Section)` 문제를 다룸

## 1.1. 공유 자원과 임계 구역
![alt text](<../설명사진/[OS] 프로세스 - 공유자원과 임계구역.png>)
* **공유 자원**
    * 여러 스레드나 프로세스가 <U>동시에 접근하거나 수정할 수 있는 자원</U> (변수, DB, 파일, 메모리 공간)
* **임계 구역**
    * 공유 자원에 접근하여 수정하는 코드의 영역
    * <U>동시에 실행되면 문제가 발생</U>하는 자원에 접근하는 코드의 영역
* **공유 자원과 임계 구역의 이상적인 흐름**![alt text](<../설명사진/[OS] 프로세스 - 공유자원과 임계구역의 이상적인 시퀀스.png>)

<br></br>

# 2. 수행시기 제어 
* 프로세스 동기화에서 수행 시기를 맞추기 위해 필요한 2가지 제어 방식이 존재함

## 2.1. 실행 순서 제어
![alt text](<../설명사진/[OS] 프로세스 - 수행 실행 순서 제어.png>)
* 프로세스가 올바르게 수행되기 위해 실행되는 흐름을 제어함
* 올바른 수행 과정을 제어함으로 원하는 동작을 수행하게 함

## 2.2. 상호 배제를 위한 동기화 
* 동시에 접근하면 안되는 하나의 자원에 하나의 프로세스만 접근되게 제어함 
* **상호 배제를 위한 동기화의 3가지 원칙**
    * **상호배제 원칙:** 한 프로세스가 임계 구역에 진입 했다면 다른 프로세스는 임게 구역에 들어올 수 없다.
    * **진행 원칙:** 임계 구역에 어떤 프로세스도 진입하지 않았다면 임계 구역에 진입하고자 하는 프로세스는 들어갈 수 있어야 한다.
    * **유한 대기 원칙:** 한 프로세스가 임계 구역에 진입하고 싶다면 그 프로세스는 언젠가는 임계 구역에 들어갈 수 있어야한다. (무한 대기 되어서는 아니된다.)
<br></br>

# 3. 공유 자원 접근과 동기화 문제

## 3.1. 동시 접근 허용(Race Condition) 문제
* <U>두 가지 이상의 프로세스가 **임계구역**에 진입했을 때 발생</U>하는 문제
* 한 프로세스가 임계 구역에서 작업 중일 때, 다른 프로세스가 동시에 접근하면 원하는 동작이 이루어지지 않을 수 있음

![alt text](<../설명사진/[OS] 프로세스 - 동시 접근 허용 문제.png>)
* **기대하던 동작**
    1. 10000원 조회
    2. 5000원 출금
    3. 출금된 금액으로 업데이트 (Result: 5000원)
    4.  잔액 조회 (5000원)
    5. 입금 (3000원)
    6. 입금된 내용으로 업데이트 (Result: 8000원)
* **시퀀스 다이어그램의 동작 (Race Condition 발생)**
    1. 10000원 조회 (Process 1)
    2. 10000원 조회 (Process 2)
    3. 5000원 출금 (Process 1)
    4. Process 2에서 여전히 Result 값이 10000이라고 판단 후
    3000원 입금 (Process 2) (Result: 13000)


## 3.2. 생산자와 소비자 문제 (Producer-Consumer Problem)
* <U>여러 프로세스 or 스레드가 **공유 자원**에 접근, 수정할 때 발생하는 문제</U>
* 생산자에서 데이터를 생성하면 소비자는 생산된 데이터를 소비하는 형태로 동작
* 생산자는 데이터를 버퍼에 넣고, 소비자는 버퍼에서 데이터를 꺼냄
    * **문제 상황**
        - 버퍼가 꽉 찼는데 생산자가 더 넣으면 문제
        - 버퍼가 비었는데 소비자가 꺼내려 하면 문제

```java
public class Main {
    // 공유 변수 
    public static int sumValue = 10;
    public static void main(String[] args) {
        System.out.println("초기 합계:" + sumValue);

        Thread producer = new Thread(Main::produce);
        Thread consumer = new Thread(Main::consume);

        producer.start();
        consumer.start();
        
        System.out.println("producer, consumer 스레드 실행 후 합계: " + sumValue);
    }
    public static void produce() {
        for (int i = 0; i < 100,000; i++) {
            sumValue++; // sumValue + 1
        }
    }

    public static void consume() {
        for (int i = 0; i < 100,000; i++) {
            sumValue--; // sumValue - 1
        }
    }
}

// 결과 값
/**
초기 합계: 10
producer, consumer 스레드 실행 이후 합계: 1314
**/
```
![alt text](<../설명사진/[OS] 프로세스 -생산자와 소비자 문제 (Producer-Consumer Problem).png>)